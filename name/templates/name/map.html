{% extends "name/name.html" %}
{% load staticfiles %}
{% block head-extra %}
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
<link rel="stylesheet" href="{% static "name/css/MarkerCluster.css" %}" />
<link rel="stylesheet" href="{% static "name/css/MarkerCluster.Default.css" %}" />
<script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/leaflet.markercluster.js"></script>
{% endblock %}
{% block title %}Map{% endblock %}
{% block content %}

    <div class="row">
        <div class="col-sm-12">
            <div id="map" style="width: 100%; height: 800px"></div>
        </div>
    </div>

    <script>
        var map = L.map('map').setView([{{ locations.0.latitude }}, {{ locations.0.longitude }}], 5);
        L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>'
        }).addTo(map);
        var addressPoints = [
        {% for l in locations %}
            {% if l.status == 0 %}
                                                                                {# FIXME: Remove hardcoded url #}
            [{{ l.latitude }}, {{ l.longitude }}, "<i class='icon-building'></i> <a href='/name/{{ l.belong_to_name.name_id }}'>{{ l.belong_to_name.name }}</a>"],
            {% endif %}
        {% endfor %}
        ];
        var markers = L.markerClusterGroup({showCoverageOnHover: false});
        for (var i = 0; i < addressPoints.length; i++) {
            var a = addressPoints[i];
            var title = a[2];
            var marker = L.marker(new L.LatLng(a[0], a[1]), { title: title });
            marker.bindPopup(title);
            markers.addLayer(marker);
        }
        map.addLayer(markers);
    </script>
{% endblock %}
